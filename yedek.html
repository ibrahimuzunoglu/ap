<script>
    document.addEventListener('DOMContentLoaded', function() {
const carBrandSelect = $('#car-brand'); // jQuery ile seçin
const carModelSelect = $('#car-model');
const carDetailSelect = $('#car-detail');

// `select2`'yi başlat
carBrandSelect.select2();
carModelSelect.select2();
carDetailSelect.select2();

// Araç markalarını almak için API'ye istek yap
fetch('http://127.0.0.1:5000/cars')
    .then(response => response.json())
    .then(data => {
        // Araç markalarını drop-down menüsüne ekle
        data.forEach(car => {
            const option = new Option(car.brand, car.brand, false, false);
            carBrandSelect.append(option);
        });

        // `select2`'yi yeniden başlat
        carBrandSelect.trigger('change.select2');
    })
    .catch(error => {
        console.error('Verileri alırken hata:', error);
    });

// Araç markası seçildiğinde modelleri yükle
carBrandSelect.on('change', function() {
    const selectedBrand = this.value;
    carModelSelect.empty().append('<option value="0">Choose Car Model</option>'); // Mevcut seçenekleri temizle
    carDetailSelect.empty().append('<option value="0">Choose Model Detail</option>'); // Model detaylarını temizle

    // Seçilen marka ile ilgili modelleri almak için API'ye tekrar istek yap
    fetch('http://127.0.0.1:5000/cars')
        .then(response => response.json())
        .then(data => {
            const selectedCar = data.find(car => car.brand === selectedBrand); // Seçilen markaya göre veriyi bul
            if (selectedCar) {
                // Markaya ait modelleri ekle
                Object.keys(selectedCar.models).forEach(model => {
                    const option = new Option(model, model, false, false);
                    carModelSelect.append(option);
                });

                // `select2`'yi yeniden başlat
                carModelSelect.trigger('change.select2');
            }
        })
        .catch(error => {
            console.error('Modelleri alırken hata:', error);
        });
});

// Araç modeli seçildiğinde model detaylarını yükle
carModelSelect.on('change', function() {
    const selectedBrand = carBrandSelect.val();
    const selectedModel = this.value;
    carDetailSelect.empty().append('<option value="0">Choose Model Detail</option>'); // Mevcut seçenekleri temizle

    // Seçilen model için detayları yükle
    fetch('http://127.0.0.1:5000/cars')
        .then(response => response.json())
        .then(data => {
            const selectedCar = data.find(car => car.brand === selectedBrand); // Seçilen markaya göre veriyi bul
            if (selectedCar && selectedModel) {
                const modelDetails = selectedCar.models[selectedModel]; // Seçilen modelin detaylarını al
                if (modelDetails) {
                    modelDetails.forEach(detail => {
                        const option = new Option(detail, detail, false, false);
                        carDetailSelect.append(option);
                    });

                    // `select2`'yi yeniden başlat
                    carDetailSelect.trigger('change.select2');
                }
            }
        })
        .catch(error => {
            console.error('Model detaylarını alırken hata:', error);
        });
});
});

</script>